# A recipe similar enough to r-base
# it contains a few tricky aspects of the jpeg->libjpeg-turbo migrations in it
{% set native = 'm2w64-' if win else '' %}
{% set posix = 'm2-' if win else '' %}
{% set version = "4.2.2" %}

package:
  name: r-base-split
  version: {{ version }}

source:
  url: https://cran.r-project.org/src/base/R-4/R-{{ version }}.tar.gz
  sha256: 0ff62b42ec51afa5713caee7c4fde7a0c45940ba39bef8c5c9487fef0c953df5

build:
  skip: true  # [win]
  number: 3

outputs:
  - name: r-base
    requirements:
      build:
        - bzip2                               # [build_platform != target_platform]
        - cairo                               # [build_platform != target_platform]
        - libjpeg-turbo                       # [build_platform != target_platform]
        - libiconv                            # [osx and (build_platform != target_platform)]
      host:
        - cairo                              # [not win]
        - {{ native }}libjpeg-turbo          # [win]
        - libjpeg-turbo                      # [not win]
        - libiconv                           # [osx]
        - {{ native }}libiconv               # [win]
        - libuuid                            # [linux]
      run:
        - {{ native }}bzip2                    # [win]
        - {{ native }}libjpeg-turbo            # [win]

    test:
      commands:
        - Rscript -e "stopifnot(capabilities('jpeg'), TRUE)"
        - Rscript -e "stopifnot(capabilities('png'), TRUE)"
        - if not exist %PREFIX%\\Lib\\R\\bin\\x64\\R.lib exit 1  # [win]
      files:
        - test-svg.R


  - name: cross-r-base
    build:
      skip: true  # [win]
    script: install-cross-activate.sh
    requirements:
      run:
        - {{ pin_subpackage("r-base", exact=True) }}
        - rsync
    test:
      commands:
        - test -f $PREFIX/etc/conda/activate.d/activate-cross-r-base.sh

about:
  home: http://www.r-project.org/
  license: GPL-2.0-or-later
  license_family: GPL
  license_file: COPYING
  summary: R is a free software environment for statistical computing and graphics.

extra:
  feedstock-name: r-base
  recipe-maintainers:
    - conda-forge/r
